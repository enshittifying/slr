<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">SLR Workflow</a>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">Dashboard</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid mt-3">
      <h1>Welcome, <span id="userName"><?= userName ?></span>! <span id="adminBadge" class="badge badge-warning ml-2" style="display:none;">Admin</span></h1>
      <span id="userEmailHidden" style="display:none;"><?= userEmail ?></span>

      <div class="row">
        <div class="col-md-6">
          <h2>My Tasks</h2>
          <div id="tasks-container"></div>
        </div>
        <div class="col-md-6">
          <h2>Available Forms</h2>
          <div id="forms-container"></div>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-md-6">
          <h2>Attendance Record</h2>
          <div id="attendance-container"></div>
        </div>
        <div class="col-md-6">
          <h2>Notifications</h2>
          <div id="notifications-container"></div>
        </div>
      </div>

      <div class="row mt-4" id="admin-section" style="display:none;">
        <div class="col-md-12">
          <ul class="nav nav-tabs" id="adminTabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="tab-tasks" data-toggle="tab" href="#admin-tasks" role="tab">Tasks</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tab-members" data-toggle="tab" href="#admin-members" role="tab">Members</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tab-assignments" data-toggle="tab" href="#admin-assignments" role="tab">Assignments</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tab-forms" data-toggle="tab" href="#admin-forms" role="tab">Forms</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tab-attendance" data-toggle="tab" href="#admin-attendance" role="tab">Attendance</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tab-config" data-toggle="tab" href="#admin-config" role="tab">Config</a>
            </li>
          </ul>
          <div class="tab-content p-3 border border-top-0">
            <div class="tab-pane fade show active" id="admin-tasks" role="tabpanel">
              <div class="card mb-3">
                <div class="card-header">Create and Assign Task</div>
                <div class="card-body">
                  <form id="create-task-form">
                    <div class="form-row">
                      <div class="form-group col-md-4">
                        <label for="task-title">Title</label>
                        <input type="text" class="form-control" id="task-title" required>
                      </div>
                      <div class="form-group col-md-4">
                        <label for="task-due">Due Date</label>
                        <input type="date" class="form-control" id="task-due">
                      </div>
                      <div class="form-group col-md-4">
                        <label for="assignee-email">Assign To</label>
                        <select class="form-control" id="assignee-email"></select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="task-desc">Description</label>
                      <textarea id="task-desc" class="form-control" rows="2"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Create & Assign</button>
                  </form>
                </div>
              </div>

              <div class="card">
                <div class="card-header">All Tasks</div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm" id="tasks-table">
                      <thead>
                        <tr>
                          <th>ID</th><th>Title</th><th>Due</th><th>Assignees</th><th>Assign</th><th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="admin-members" role="tabpanel">
              <div class="card mb-3">
                <div class="card-header">Add Member</div>
                <div class="card-body">
                  <form id="create-member-form" class="form-inline">
                    <input type="text" class="form-control mb-2 mr-2" id="member-fullname" placeholder="Full name" required>
                    <input type="email" class="form-control mb-2 mr-2" id="member-email" placeholder="Email" required>
                    <input type="text" class="form-control mb-2 mr-2" id="member-role" placeholder="Role (e.g., Admin)" required>
                    <button type="submit" class="btn btn-secondary mb-2">Add</button>
                  </form>
                </div>
              </div>
              <div class="card">
                <div class="card-header">All Members</div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm" id="members-table">
                      <thead>
                        <tr>
                          <th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="admin-assignments" role="tabpanel">
              <div class="card">
                <div class="card-header">All Assignments</div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm" id="assignments-table">
                      <thead>
                        <tr>
                          <th>ID</th><th>Task</th><th>Member</th><th>Status</th><th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="admin-forms" role="tabpanel">
              <div class="card mb-3">
                <div class="card-header">Create Form Definition</div>
                <div class="card-body">
                  <form id="create-formdef-form" class="form-inline">
                    <input class="form-control mb-2 mr-2" id="formdef-name" placeholder="Form Name" required>
                    <input class="form-control mb-2 mr-2" id="formdef-question" placeholder="Question Title" required>
                    <input class="form-control mb-2 mr-2" id="formdef-type" placeholder="Item Type (text, multipleChoice, ...)" required>
                    <input class="form-control mb-2 mr-2" id="formdef-options" placeholder="Options (comma-separated)">
                    <button type="submit" class="btn btn-secondary mb-2">Add Definition</button>
                  </form>
                </div>
              </div>
              <div class="card">
                <div class="card-header">Form Definitions</div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm" id="forms-table">
                      <thead>
                        <tr>
                          <th>ID</th><th>Name</th><th>Form ID</th><th>Question</th><th>Type</th><th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="admin-attendance" role="tabpanel">
              <div class="card mb-3">
                <div class="card-header">Create Tracked Event</div>
                <div class="card-body">
                  <form id="create-event-form" class="form-inline">
                    <input class="form-control mb-2 mr-2" id="event-title" placeholder="Event Title" required>
                    <input type="datetime-local" class="form-control mb-2 mr-2" id="event-start" required>
                    <input type="datetime-local" class="form-control mb-2 mr-2" id="event-end" required>
                    <select multiple class="form-control mb-2 mr-2" id="event-members" style="min-width:260px"></select>
                    <button type="submit" class="btn btn-secondary mb-2">Create</button>
                  </form>
                </div>
              </div>
              <div class="card">
                <div class="card-header">Attendance Logs</div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm" id="attendance-table">
                      <thead>
                        <tr>
                          <th>Event</th><th>Member</th><th>Date</th><th>Status</th><th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="admin-config" role="tabpanel">
              <div class="card">
                <div class="card-header">System Config</div>
                <div class="card-body">
                  <form id="create-config-form" class="form-inline mb-3">
                    <input class="form-control mb-2 mr-2" id="cfg-key" placeholder="Key" required>
                    <input class="form-control mb-2 mr-2" id="cfg-value" placeholder="Value" required>
                    <button type="submit" class="btn btn-secondary mb-2">Set</button>
                  </form>
                  <div class="table-responsive">
                    <table class="table table-sm" id="config-table">
                      <thead>
                        <tr>
                          <th>Key</th><th>Value</th><th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <?!= HtmlService.createHtmlOutputFromFile('client_side_script').getContent(); ?>
  </body>
</html>
